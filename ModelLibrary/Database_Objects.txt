0 : AnsiString
1 : Binary
2 : Byte
3 : Boolean
4 : Currency
5 : Date
6 : DateTime
7 : Decimal
8 : Double
9 : Guid
10 : Int16
11 : Int32
12 : Int64
13 : Object
14 : SByte
15 : Single
16 : String
17 : Time
18 : UInt16
19 : UInt32
20 : UInt64
21 : VarNumeric
22 : AnsiStringFixedLength
23 : StringFixedLength
25 : Xml
26 : DateTime2
27 : DateTimeOffset



DROP TABLE SecurityProfiles;
DROP TABLE SecurityProfileentitlement;
DROP TABLE Securityentitlements;
DROP TABLE Securityusers;

create table SecurityAudit(
Id             AUTOINCREMENT NOT NULL PRIMARY KEY,
UserName      TEXT(50)      NOT NULL,
EventDate     DATETIME      NOT NULL DEFAULT NOW(),
EventComments TEXT(255),
CreatedBy     TEXT(50),
CreatedOn     DATETIME,
UpdatedBy     TEXT(50),
UpdatedOn     DATETIME
)

CREATE TABLE SecurityProfiles (
    [Id]               AUTOINCREMENT  PRIMARY KEY,
    [ProfileName]     TEXT(50)     NOT NULL UNIQUE,
	[CreatedBy]            TEXT(50)			        ,
	[CreatedOn]            DATETIME			        ,
	[UpdatedBy]            TEXT(50)			        ,
	[UpdatedOn]            DATETIME
);

CREATE TABLE SecurityEntitlements (
    [Id]               AUTOINCREMENT   PRIMARY KEY,
    [EntitlementName] TEXT(50)     NOT NULL UNIQUE,
	[CreatedBy]            TEXT(50)			        ,
	[CreatedOn]            DATETIME			        ,
	[UpdatedBy]            TEXT(50)			        ,
	[UpdatedOn]            DATETIME

);

CREATE TABLE SecurityProfileEntitlements (
    [Id]               AUTOINCREMENT   UNIQUE,
    [ProfileName]       TEXT(50)          NOT NULL,
    [EntitlementName]   TEXT(50)          NOT NULL,
	[CreatedBy]            TEXT(50)			        ,
	[CreatedOn]            DATETIME			        ,
	[UpdatedBy]            TEXT(50)			        ,
	[UpdatedOn]            DATETIME                    ,
    PRIMARY KEY([ProfileName],[EntitlementName])
);

CREATE TABLE SecurityUsers (
    [Id]                    AUTOINCREMENT  PRIMARY KEY  ,
    [UserName]             TEXT(50)     NOT NULL UNIQUE,
    [FullName]             TEXT(100)    NOT NULL       ,
    [UserPassword]         TEXT(100)    NOT NULL       ,
    [ProfileName]          TEXT(50)     NOT NULL       ,
	[IsActive]             YESNO				        ,
	[Email]                 TEXT(100)			        ,
	[FailedLoginAttempts] NUMBER		 DEFAULT 0      ,
	[LastLoginDate]       DATETIME			        ,
	[LastChangePassword]  DATETIME			        ,
	[CreatedBy]            TEXT(50)			        ,
	[CreatedOn]            DATETIME			        ,
	[UpdatedBy]            TEXT(50)			        ,
	[UpdatedOn]            DATETIME
);


CREATE TABLE CustomersNationalities (
    [Id]               AUTOINCREMENT   UNIQUE,
    [NationalityCode]       TEXT(50)          NOT NULL,
    [NationalityDesc]       TEXT(100)          NOT NULL UNIQUE,
	[CreatedBy]            TEXT(50)			        ,
	[CreatedOn]            DATETIME			        ,
	[UpdatedBy]            TEXT(50)			        ,
	[UpdatedOn]            DATETIME                    ,
    PRIMARY KEY([NationalityCode])
);

TRANSFORM count(entitlementname) 
SELECT profilename 
FROM securityprofileentitlements
GROUP BY profilename
PIVOT entitlementname;

TRANSFORM iif(count(pe.profilename)>0,'✓',null) 
SELECT e.id, e.entitlementname 
FROM securityprofileentitlements pe inner join securityentitlements e
  ON pe.entitlementname = e.entitlementname
GROUP BY e.id, e.entitlementname
ORDER BY e.entitlementname
PIVOT pe.profilename;


INSERT INTO SecurityProfiles ([ProfileName]) VALUES ('Admin');

INSERT INTO SecurityUsers ([UserName],[FullName],[UserPassword],[ProfileName],[CreatedBy],[CreatedOn],[IsActive]) 
VALUES ('Admin','Admin','{ENC}H4sIAAAAAAAEAJsS1rzhzR+NjwCZz56xCAAAAA==','Admin','SYSTEM',now(),true);

	insert into securityentitlements (entitlementname,createdon,createdby,updatedon,updatedby) values ('Rooms',now(),'Admin',now(),'Admin');
	insert into securityentitlements (entitlementname,createdon,createdby,updatedon,updatedby) values ('Buildings',now(),'Admin',now(),'Admin');
	insert into securityentitlements (entitlementname,createdon,createdby,updatedon,updatedby) values ('Compounds',now(),'Admin',now(),'Admin');
	insert into securityentitlements (entitlementname,createdon,createdby,updatedon,updatedby) values ('Accommodation Categories',now(),'Admin',now(),'Admin');
	insert into securityentitlements (entitlementname,createdon,createdby,updatedon,updatedby) values ('Residents',now(),'Admin',now(),'Admin');
	insert into securityentitlements (entitlementname,createdon,createdby,updatedon,updatedby) values ('Companies',now(),'Admin',now(),'Admin');
	insert into securityentitlements (entitlementname,createdon,createdby,updatedon,updatedby) values ('Projects',now(),'Admin',now(),'Admin');
	insert into securityentitlements (entitlementname,createdon,createdby,updatedon,updatedby) values ('Contracts',now(),'Admin',now(),'Admin');
	insert into securityentitlements (entitlementname,createdon,createdby,updatedon,updatedby) values ('Users',now(),'Admin',now(),'Admin');
	insert into securityentitlements (entitlementname,createdon,createdby,updatedon,updatedby) values ('Entitlements',now(),'Admin',now(),'Admin');
	insert into securityentitlements (entitlementname,createdon,createdby,updatedon,updatedby) values ('Profiles',now(),'Admin',now(),'Admin');
	insert into securityentitlements (entitlementname,createdon,createdby,updatedon,updatedby) values ('Residents Search',now(),'Admin',now(),'Admin');
	insert into securityentitlements (entitlementname,createdon,createdby,updatedon,updatedby) values ('New Check In',now(),'Admin',now(),'Admin');
	insert into securityentitlements (entitlementname,createdon,createdby,updatedon,updatedby) values ('SQL Viewer',now(),'Admin',now(),'Admin');
	insert into securityentitlements (entitlementname,createdon,createdby,updatedon,updatedby) values ('Bills',now(),'Admin',now(),'Admin');
	insert into securityentitlements (entitlementname,createdon,createdby,updatedon,updatedby) values ('Check In',now(),'Admin',now(),'Admin');
	insert into securityentitlements (entitlementname,createdon,createdby,updatedon,updatedby) values ('Check Out',now(),'Admin',now(),'Admin');
	insert into securityentitlements (entitlementname,createdon,createdby,updatedon,updatedby) values ('Room Movement',now(),'Admin',now(),'Admin');
	insert into securityentitlements (entitlementname,createdon,createdby,updatedon,updatedby) values ('Encryption Tool',now(),'Admin',now(),'Admin');

insert into securityprofileentitlements (profilename,entitlementname,createdby,createdon,updatedby,updatedon) values ('Admin','Encryption Tool','Admin',now(),'Admin',now());
insert into securityprofileentitlements (profilename,entitlementname,createdby,createdon,updatedby,updatedon) values ('Admin','Rooms','Admin',now(),'Admin',now());
insert into securityprofileentitlements (profilename,entitlementname,createdby,createdon,updatedby,updatedon) values ('Admin','Buildings','Admin',now(),'Admin',now());
insert into securityprofileentitlements (profilename,entitlementname,createdby,createdon,updatedby,updatedon) values ('Admin','Compounds','Admin',now(),'Admin',now());
insert into securityprofileentitlements (profilename,entitlementname,createdby,createdon,updatedby,updatedon) values ('Admin','Accommodation Categories','Admin',now(),'Admin',now());
insert into securityprofileentitlements (profilename,entitlementname,createdby,createdon,updatedby,updatedon) values ('Admin','Residents','Admin',now(),'Admin',now());
insert into securityprofileentitlements (profilename,entitlementname,createdby,createdon,updatedby,updatedon) values ('Admin','Companies','Admin',now(),'Admin',now());
insert into securityprofileentitlements (profilename,entitlementname,createdby,createdon,updatedby,updatedon) values ('Admin','Projects','Admin',now(),'Admin',now());
insert into securityprofileentitlements (profilename,entitlementname,createdby,createdon,updatedby,updatedon) values ('Admin','Contracts','Admin',now(),'Admin',now());
insert into securityprofileentitlements (profilename,entitlementname,createdby,createdon,updatedby,updatedon) values ('Admin','Users','Admin',now(),'Admin',now());
insert into securityprofileentitlements (profilename,entitlementname,createdby,createdon,updatedby,updatedon) values ('Admin','Entitlements','Admin',now(),'Admin',now());
insert into securityprofileentitlements (profilename,entitlementname,createdby,createdon,updatedby,updatedon) values ('Admin','Profiles','Admin',now(),'Admin',now());
insert into securityprofileentitlements (profilename,entitlementname,createdby,createdon,updatedby,updatedon) values ('Admin','Residents Search','Admin',now(),'Admin',now());
insert into securityprofileentitlements (profilename,entitlementname,createdby,createdon,updatedby,updatedon) values ('Admin','New Check In','Admin',now(),'Admin',now());
insert into securityprofileentitlements (profilename,entitlementname,createdby,createdon,updatedby,updatedon) values ('Admin','SQL Viewer','Admin',now(),'Admin',now());
insert into securityprofileentitlements (profilename,entitlementname,createdby,createdon,updatedby,updatedon) values ('Admin','Bills','Admin',now(),'Admin',now());
insert into securityprofileentitlements (profilename,entitlementname,createdby,createdon,updatedby,updatedon) values ('Admin','Check In','Admin',now(),'Admin',now());
insert into securityprofileentitlements (profilename,entitlementname,createdby,createdon,updatedby,updatedon) values ('Admin','Check Out','Admin',now(),'Admin',now());
insert into securityprofileentitlements (profilename,entitlementname,createdby,createdon,updatedby,updatedon) values ('Admin','Room Movement','Admin',now(),'Admin',now());
